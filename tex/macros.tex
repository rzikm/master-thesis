%%% This file contains definitions of various useful macros and environments %%%
%%% Please add more macros here instead of cluttering other files with them. %%%

%%% Minor tweaks of style

% These macros employ a little dirty trick to convince LaTeX to typeset
% chapter headings sanely, without lots of empty space above them.
% Feel free to ignore.
\makeatletter
\def\@makechapterhead#1{
  {\parindent \z@ \raggedright \normalfont
   \Huge\bfseries \thechapter. #1
   \par\nobreak
   \vskip 20\p@
}}
\def\@makeschapterhead#1{
  {\parindent \z@ \raggedright \normalfont
   \Huge\bfseries #1
   \par\nobreak
   \vskip 20\p@
}}
\makeatother

% This macro defines a chapter, which is not numbered, but is included
% in the table of contents.
\def\chapwithtoc#1{
\chapter*{#1}
\addcontentsline{toc}{chapter}{#1}
}

% Draw black "slugs" whenever a line overflows, so that we can spot it easily.
\overfullrule=1mm



%%% Functional foreach construct
%%% (https://stackoverflow.com/questions/2402354/split-comma-separated-parameters-in-latex)

\makeatletter

% #1 - Function to call on each comma-separated item in #3
% #2 - Parameter to pass to function in #1 as first parameter
% #3 - Comma-separated list of items to pass as second parameter to function #1
\def\foreach#1#2#3{%
  \@test@foreach{#1}{#2}#3,\@end@token%
}

% Internal helper function - Eats one input
\def\@swallow#1{}

% Internal helper function - Checks the next character after #1 and #2 and
% continues loop iteration if \@end@token is not found
\def\@test@foreach#1#2{%
  \@ifnextchar\@end@token%
    {\@swallow}%
    {\@foreach{#1}{#2}}%
}

% Internal helper function - Calls #1{#2}{#3} and recurses
% The magic of splitting the third parameter occurs in the pattern matching of the \def
\def\@foreach#1#2#3,#4\@end@token{%
  #1{#2}{#3}%
  \@test@foreach{#1}{#2}#4\@end@token%
}

%%% foreach usage:
% Example-function used in foreach, which takes two params and builds hrefs
%\def\makehref#1#2{\href{#1/#2}{#2}}

% Using foreach by passing #1=function, #2=constant parameter, #3=comma-separated list
%\foreach{\makehref}{http://stackoverflow.com}{2409851,2408268}

% Will in effect do
%\href{http://stackoverflow.com/2409851}{2409851}\href{http://stackoverflow.com/2408268}{2408268}

\makeatother



%%% Macros for definitions, theorems, claims, examples, ... (requires amsthm package)

\theoremstyle{plain}
\newtheorem{thm}{Theorem}
\newtheorem{lemma}[thm]{Lemma}
\newtheorem{claim}[thm]{Claim}

\theoremstyle{plain}
\newtheorem{defn}{Definition}

\theoremstyle{remark}
\newtheorem*{cor}{Corollary}
\newtheorem*{rem}{Remark}
\newtheorem*{example}{Example}

%%% An environment for proofs

\newenvironment{myproof}{
  \par\medskip\noindent
  \textit{Proof}.
}{
\newline
\rightline{$\qedsymbol$}
}

%%% An environment for typesetting of program code and input/output
%%% of programs. (Requires the fancyvrb package -- fancy verbatim.)

\DefineVerbatimEnvironment{code}{Verbatim}{fontsize=\small, frame=single}

%%% The field of all real and natural numbers
\newcommand{\R}{\mathbb{R}}
\newcommand{\N}{\mathbb{N}}

%%% Useful operators for statistics and probability
\DeclareMathOperator{\pr}{\textsf{P}}
\DeclareMathOperator{\E}{\textsf{E}\,}
\DeclareMathOperator{\var}{\textrm{var}}
\DeclareMathOperator{\sd}{\textrm{sd}}

%%% Transposition of a vector/matrix
\newcommand{\T}[1]{#1^\top}

%%% Various math goodies
\newcommand{\goto}{\rightarrow}
\newcommand{\gotop}{\stackrel{P}{\longrightarrow}}
\newcommand{\maon}[1]{o(n^{#1})}
\newcommand{\abs}[1]{\left|{#1}\right|}
\newcommand{\dint}{\int_0^\tau\!\!\int_0^\tau}
\newcommand{\isqr}[1]{\frac{1}{\sqrt{#1}}}

%%% Various table goodies
\newcommand{\pulrad}[1]{\raisebox{1.5ex}[0pt]{#1}}
\newcommand{\mc}[1]{\multicolumn{1}{c}{#1}}

% Outputs red TODOs in the document. Requires \usepackage{color}.
%
% Usage: \todo{Document the TODO command.}
%
% Comment out second line to disable.
\newcommand{\todo}[1]{}
\renewcommand{\todo}[1]{{\color{red} TODO: {#1}}}

% the symbol of .NET
\newcommand{\dotnet}{.NET\@}

% prettier C# typesetting
\newcommand{\csharp}{%
  {\settoheight{\dimen0}{C}C\kern-.05em \resizebox{!}{\dimen0}{\raisebox{\depth}{\#}}}}

% special items for itemize and enumerate environments which have a label
\newcommand\litem[1]{\item{\textit{#1}}:}

% special item for description lists to make the description go on the next line
\newcommand\ditem[1]{\item[#1] \leavevmode \\}
\newcommand\ditemWithComment[2]{\item[#1] \hfill \textit{(#2)} \leavevmode \\}

% macro for typesetting library names
\newcommand\libname[1]{\texttt{\itshape#1}}

% macros for library names used throughout the thesis
\newcommand{\libmsquic}{\libname{MsQuic}}
\newcommand{\libcurl}{\libname{libcurl}}
\newcommand{\libopenssl}{\libname{OpenSSL}}
\newcommand{\libschannel}{\libname{Schannel}}

% environment setting common attributes of figures
\newcommand{\figureArgs}{} % dummy macro to be redefined, used to make caption go under the figure
\newenvironment{myFigure}[2]{% [label, caption]
  \renewcommand{\figureArgs}{\caption{#2}\label{#1}}%
  \figure[ht]{}
  \centering
}{ %
  \figureArgs{}
  \endfigure{}
}

% macros for typesetting various code elements inside th text, TODO: add colors

\definecolor{codecolorclass}{rgb}{0, 0.4, 0}
\definecolor{codecolorkeyword}{rgb}{0, 0, 0.5}
\definecolor{codecolornamespace}{gray}{0}

\newcommand{\class}[1]{{\color{codecolorclass}\texttt{#1}}}
\newcommand{\keyword}[1]{\color{codecolorkeyword}\texttt{#1}}
\newcommand{\namespace}[1]{\color{codecolornamespace}\texttt{#1}}
\newcommand{\method}[1]{\textit{\texttt{#1}}}

% macros for typesetting description lists with C# class members

\newcommand{\propgetset}{\{ \keyword{get}; \keyword{set}; \}}
\newcommand{\propget}{\{ \keyword{get}; \}}
\newcommand{\propset}{\{ \keyword{set}; \}}

\newcommand{\ditemsrcsize}{\footnotesize}


\newcommand{\ditemmethodseparator}{}

% method to apply in \foreach macro
\def\makeditemmethodarg#1#2{\ditemmethodseparator{}\class{#2}%
\renewcommand{\ditemmethodseparator}{, }%set proper separator for the next item
}

\newcommand{\ditemmethodmakearglist}[1]{% arglist
\renewcommand{\ditemmethodseparator}{}%clear the separator for the first item
\foreach{\makeditemmethodarg}{}{#1}%
}

\newcommand{\ditemmethod}[3]% type, name, args (types only)
  {\ditem{\ditemsrcsize\texttt{\class{#1} \method{#2}(\ditemmethodmakearglist{#3})}}}

\newcommand{\ditemctor}[2]% name, args
  {\ditem{\ditemsrcsize\texttt{\method{#1}(\ditemmethodmakearglist{#2})}}}

\newcommand{\ditemproperty}[3]% type, name, get/set
  {\ditem{\ditemsrcsize\texttt{\class{#1} \method{#2} #3}}}

% environment setting common attributes of tables
\newenvironment{myTable}[5][\normalsize]{% [fontsize, label, caption, columnspec, header]
  \table[ht]
  #1
  \caption{#3}\label{#2}% for tables, the caption goes to the top
  \centering
  \tabular{#4}
  \toprule
  #5 \\
  \midrule
}{ %
  \bottomrule
  \endtabular{}
  \endtable{}
}

% checkmark
\def\checkmark{\tikz\fill[scale=0.4](0,.35) -- (.25,0) -- (1,.7) -- (.25,.15) -- cycle;}
